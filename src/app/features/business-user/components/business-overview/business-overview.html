<div class="dashboard-container">
  <!-- Sidebar -->
  <app-business-review-sidebar
    (menuItemSelected)="onMenuItemSelected($event)"
  ></app-business-review-sidebar>
  @if (currentView === 'overview') {
    <div class="main-content">
      <!-- Header Section -->
      <div class="dashboard-header">
        <div class="header-top">
          <h1 class="dashboard-title">Quality Review Dashboard</h1>
          <span class="last-refresh">Last Refresh: Today, {{ lastRefresh | date: 'short' }}</span>
        </div>
        <!-- <div class="breadcrumb">
          <span class="breadcrumb-active">Overview</span>
        </div> -->
      </div>

      <div class="create-request-container">
        <img src="/imgs/create-request.png" alt="Create New Request" class="create-request-image" />
        <div class="create-request-overlay">
          <div class="create-request-content">
            <div class="create-request-text">
              <h2 class="create-request-title">Need to<br /><strong>submit a request?</strong></h2>
              <p class="create-request-description">
                Create and track a new request for quality review.
              </p>
            </div>
            <button class="create-request-btn" (click)="onSubmitRequest()">
                   <img src="svgs/add-square.svg" width="24" height="24" alt="add-square" />

              Create new request
            </button>
          </div>
        </div>
      </div>

      <div class="table-section">
        <h3 class="requests-title">Requests</h3>
        <!-- Search and Filter -->
        <div class="search-filter-section">
          <div class="search-box">
            <input
              type="text"
              placeholder="Search by id or Type"
              [(ngModel)]="searchQuery"
              (input)="onSearch(searchQuery)"
              class="search-input"
            />
                               <img class="search-icon" src="svgs/search.svg" width="24" height="24" alt="search" />

          </div>
          <button class="filter-button">
            Filter
                              <img src="svgs/filter-list.svg" width="24" height="24" alt="filter-list" />

          </button>
        </div>

        <!-- Tabs -->
        <app-business-tab-navigation
          [tabs]="['All Requests', 'Need Review', 'Approved', 'Rejected', 'Validation Failed']"
          (tabChanged)="onTabChange($event)"
        >
        </app-business-tab-navigation>

        <!-- Request Table -->
        <app-business-request-table
          [requests]="displayedRequests"
          [currentPage]="currentPage"
          [totalPages]="totalPages"
          [totalItems]="filteredRequests.length"
          [itemsPerPage]="pageSize"
          (nextPage)="nextPage()"
          (prevPage)="prevPage()"
          (rowClick)="onRowClick($event)"
          (viewRequest)="onViewRequest($event)"
        >
        </app-business-request-table>
      </div>
    </div>
  }

  <!-- Request Detail Modal -->
  <app-business-request-detail-modal (expandModal)="onModalExpand()"></app-business-request-detail-modal>

  <!-- Requests Page -->
  @if (
    currentView === 'need-review' ||
    currentView === 'approved' ||
    currentView === 'rejected' ||
    currentView === 'validation-failed' ||
    currentView === 'under-review'
  ) {
    <app-business-requests-page [selectedTab]="currentView"></app-business-requests-page>
  }

  <!-- Request Details Page -->
  @if (currentView === 'details' && selectedRequest) {
    <app-business-request-details-page
      [selectedRequest]="selectedRequest"
      [onClose]="closeDetailsPage"
    ></app-business-request-details-page>
  }
  @if (currentView === 'create-request') {
    <app-create-request [onClose]="closeCreatePage"></app-create-request>
  }

  @if (currentView === 'submit-request') {
  <app-business-submit-request 
    [onClose]="closeSubmitPage"
    (changesDetected)="onSubmitRequestChanges($event)"
  ></app-business-submit-request>
}
</div>
